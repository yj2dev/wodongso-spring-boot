<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title th:text="${society.name}"></title>

</head>
<body>
<a href="/">우동소</a>

<div th:replace="layout/header" :: headerFragment></div>

<h2 th:text="${society.name}"></h2>
<h3 th:text="${society.simpleDesc}"></h3>
<div th:text="${society.detailDesc}"></div>
<h3 th:text="${society.officerId.getNickname()}"></h3>

<img th:src="${society.profileUrl}" style="object-fit: contain; width: 150px; height: 150px;">
<img th:src="${society.backgroundUrl}" style="object-fit: contain; width: 150px; height: 150px;">>

<th:block th:if="${society.officerId.getId() != #httpServletRequest.remoteUser}">
    <button th:value="${society.number}"
            onclick="onClickSocietyApply(this.value)">
        가입 신청
    </button>
</th:block>

<th:block th:if="${society.officerId.getId() == #httpServletRequest.remoteUser}">
    <button th:onclick="|location.href='@{/society/update/{number}(number = ${society.number})}'|">수정</button>
    <button th:onclick="|location.href='@{/society/delete(number=${society.number})}'|">삭제</button>
    <br>
    <button onclick="onClickShowSocietyApplyList()">가입신청자 조회</button>
    <div class="society_apply_list" style="display: none">
        <div th:each="v: ${recruitUserList}">
            <img th:src="${v.userProfileUrl}" style="width: 150px; object-fit: cover">
            <div th:text="${v.uId}"></div>
            <div th:text="${v.societyNumber}"></div>
            <div th:text="${v.userId}"></div>
            <div th:text="${v.userName}"></div>
            <div th:text="${v.userUniversity}"></div>
            <div th:text="${v.userMajor}"></div>
            <div th:text="${v.userContact}"></div>
            <div th:text="${v.state}"></div>
            <div th:text="${v.rejectReason}"></div>
            <div th:text="${v.createdAt}"></div>


            <form th:action="@{/society/recruit/accept}"
                  method="post">
                <input type="text" name="uid" th:value="${v.uId}" readonly style="display: none">
                <input type="text" name="number" th:value="${v.societyNumber}" readonly style="display: none">

                <button formmethod="post" type="submit" class="btn btn-md btn-primary">수락</button>
            </form>
            <form th:action="@{/society/recruit/reject}"
                  method="post">
                <input type="text" name="uid" th:value="${v.uId}" readonly style="display: none">
                <input type="text" name="number" th:value="${v.societyNumber}" readonly style="display: none">

                <button id="rejectBtn" type="submit" class="btn btn-md btn-danger">거절</button>
                <input type="text" name="content" class="form-control" style="width: 200px;"
                       onkeyup="onChangeReject(this.value)">
            </form>
        </div>
    </div>
</th:block>
<br>
<br>
<div style="display: flex; gap:24px;">

    <div th:each="v: ${categoryList}">

        <form th:action="@{/society/detail}" method="get">
            <input type="text" name="number" th:value="${society.number}" readonly style="display: none">
            <input type="text" name="cid" th:value="${v.id}" readonly style="display: none">
            <button type="submit">[[${v.name}]]</button>
        </form>
    </div>
</div>
<br>

<div th:each="v: ${contentList}">
    <img src="https://via.placeholder.com/200x200">
    <div th:text="${v.title}"></div>
    <div th:text="${v.content}"></div>
</div>


<form th:action="@{/society/category-board/write}" method="post">
    <input type="text" name="number" th:value="${society.number}" readonly style="display: none">
    <input type="text" name="categoryId" th:value="${currentCategoryId}" readonly style="display: none"> <br>
    <input type="text" name="title"><br>
    <textarea name="content"></textarea>

    <div th:with="imageCnt = 3">
        <h3 th:each="v : ${#numbers.sequence(1, imageCnt)}">
            몇개까지될까
            <input type="file" accept="image/*" name="profileImage">
        </h3>
    </div>

    <button type="submit">글쓰기</button>

</form>


<th:block th:if="${society.officerId.getId() == #httpServletRequest.remoteUser}">
    <form th:action="@{/society/category/create}" method="post">
        <input type="text" name="number" th:value="${society.number}" readonly style="display: none">
        <input type="text" name="name">
        <button type="submit">카테고리 추가</button>
    </form>
</th:block>

<div th:replace="layout/footer"></div>
<script th:inline="javascript">

    const onClickShowSocietyApplyList = () => {
        const sal = document.getElementsByClassName("society_apply_list");
        sal[0].style.display === "none" ? sal[0].style.display = "block" : sal[0].style.display = "none";
    }


    const onClickSocietyApply = (number) => {
        window.event.preventDefault();
        if ([[${#httpServletRequest.remoteUser}]] != null) location.href = `/society/apply/${number}`
        else alert("로그인 후 신청해주세요!")
    }
</script>
</body>
</html>
